<!-- /src/views/explorer.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Concept Explorer</title>

    <!-- ‚úÖ D3.js from CDN -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <!-- ‚úÖ jsPDF for PDF Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- SheetJS for .xlsx parsing -->
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>


  <!-- ‚úÖ Style -->
  <link rel="stylesheet" href="explorer.css" />
  <link rel="stylesheet" href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css"> 

</head>
<body>
<!-- === Left Sidebar === -->
<div id="sidebar">

  <div class="sidebar-section">
  <h4>Document</h4>
  <div id="document-path">Currently: ‚Äì</div>
  <!--
  <ul id="document-tree">
      <li id="doc-context" data-state="context">Context
        <ul>
          <li id="doc-lattice" data-state="lattice">Lattice</li>
          <li id="doc-implications" data-state="implications">‚âÉ Implications</li>
        </ul>
      </li>
    </ul>
  -->
  </div>

  <div class="sidebar-section" id="metrics-container">
    <h4>Parameters</h4>
    <table>
      <tr><td>Compressed</td><td>‚úì</td></tr>
      <tr><td>Concepts</td><td><span id="total-concepts">-</span></td></tr>
      <tr><td>Objects</td><td><span id="total-objects">-</span></td></tr>
      <tr><td>Attributes</td><td><span id="total-attributes">-</span></td></tr>
      <tr><td>Lattice Density</td><td><span id="lattice-density">-</span></td></tr>
    <tr><td>Avg. Stability</td><td><span id="lattice-stability">-</span></td></tr>
    </table>
  </div>

   <!-- <div class="sidebar-section" id="metrics-container">
   Metrics will be dynamically populated here 
  </div>
  -->

</div>

<!-- === Right Main Section === -->
<div id="main">
  <div id="top-panel">

    <!-- === Formal Context Panel === -->
    <div id="table-area" class="panel-area">
       <div class="panel-header">
          <span><strong>Formal Context</strong></span>
          <button>üóñ</button>
        </div>
    <div>
      
      <p class="description">
  You can either upload your own formal context, show it here, or start from a default template.
      </p>

   <!-- File Upload -->
   <div style="margin-top:10px;">
   <label for="upload-json"><strong>Upload Formal Context (.json,.csv,.xlsx,.cxt):</strong></label>
   <div id="file-input-wrapper"> 
   <input type="file" id="upload-json" accept=".json,.csv,.xlsx,.cxt">
   </div>
  </div>


   <!-- Buttons -->
   <div class="button-container">
  <button id="show-formal-context">Show Formal Context</button>
  <button id="create-formal-context">Create Formal Context</button>
  <button id="visualize-lattice" class="btn">Visualize Lattice</button>
  </div>

  <!-- Create Context modal -->
<div id="create-context-modal" class="hidden">
  <div class="ccm-card">
    <h3 style="margin:0 0 10px;">Create Formal Context</h3>

    <label style="display:block;margin:8px 0;">
      Rows (objects):
      <input id="ccm-rows" type="number" min="1" max="500" value="4" />
    </label>

    <label style="display:block;margin:8px 0;">
      Columns (attributes):
      <input id="ccm-cols" type="number" min="1" max="500" value="4" />
    </label>

    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px;">
      <button id="ccm-cancel">Cancel</button>
      <button id="ccm-confirm" style="background:#007bff;color:#fff;border:none;padding:6px 12px;border-radius:4px;">
        Create
      </button>
    </div>
  </div>
</div>


  <!-- Table renders here -->
  <div class="table-scroll-wrapper" style="margin-top:15px;">
  <div class="table-container" id="table-content"></div>
  </div>

  <!-- Table Actions -->
  <div style="margin-top: 10px;" id="table-actions" class="hidden">
    <button id="add-row">‚ûï Add Row</button>
    <button id="add-column">‚ûï Add Column</button>
  </div>

  <!-- Export -->
  <select id="context-export-dropdown" class="hidden">
  <option value="">Export Context As...</option>
  <option value="export-context-csv">CSV</option>
  <option value="export-context-cxt">CXT</option>
  <option value="export-context-json">JSON</option>
  </select>
   </div> <!-- end: inner content of Formal Context panel -->
  </div>   <!-- end: #table-area panel-area -->
</div> <!-- end #top-panel --> 


<!-- === Concept Lattice Panel === -->
<div id="lattice-area" class="panel-area">
        <div class="panel-header">
          <span><strong>Concept Lattice</strong></span>
          <button>üóñ</button>
          </div>

<!-- Upload and Load Section -->
<div id="json-upload-container">
  <div id="json-upload-flex">

    <!-- ‚úÖ Only this box will wrap Choose File + selected file name -->
      <label for="file-upload"><strong>Upload Concept Lattice (.json):</strong></label>
    
      <!-- ‚úÖ Wrap only the input in a box -->
    <div id="file-input-wrapper"> 
      <input type="file" id="file-upload" accept=".json" />
    </div>

    <div>
      <button id="load-json-file" class="primary-btn">Load JSON File</button>
    </div>

    <div>
      <p>
        If your file matches the
        <a href="https://pypi.org/project/concepts/" target="_blank">Concepts Python library format</a>,
        you can convert it to the supported JSON format.
      </p>
      <button id="convert-download" class="primary-btn">Convert and Download</button>
    </div>

  </div>
</div>

    <div class="panel-content" id="graph-container"></div>

      <!-- Controls for Labeling Mode and Save As -->
    <div class="control-section" id="labeling-save-container">
        <label for="labeling-mode"><strong>Labeling Mode:</strong></label>
        <select id="labeling-mode">
          <option value="id">ID</option>
          <option value="full">Full Labeling</option>
          <option value="reduced">Reduced Labeling</option>
        </select>
      
      
        <label for="save-as"><strong>Save as:</strong></label>
        <select id="save-as">
          <option >Select the format</option>
          <option value="export-json">JSON</option>
          <option value="export-png">PNG</option>
          <option value="export-csv">CSV</option>
          <option value="export-pdf">PDF</option>
          <option value="export-slf">SLF</option>
          </select>
        </div>

      <div id="filter-legend-container">
      <!-- Filters Section -->
      <div id="filters">
        <h3>Filter Options</h3>
        <div class="flex-row">
          <input type="text" id="object-filter" placeholder="Filter by objects (comma-separated)" />
          <input type="text" id="attribute-filter" placeholder="Filter by attributes (comma-separated)" />
          <button id="apply-filters">Apply Filters</button>
        </div>    
      </div>
    
      <!-- Legend Section -->
      <div id="legend-container">
        <h3>Legend</h3>
        <ul id="legend">
          <li><span style="background-color: orange;"></span> Matches both extent and intent</li>
          <li><span style="background-color: green;"></span> Matches extent</li>
          <li><span style="background-color: gray;"></span> Matches intent</li>
          <li><span style="background-color: blue;"></span> No match</li>
        </ul>
      </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip"></div>

    <!-- Selected Node Details -->
      <div class="control-section" id="node-info-panel">
      <span><strong>Selected Node Info</strong></span>
      <div class="panel-content" id="selected-node-info">
        Click a concept in the lattice to view its extent, intent, and other details here.
      </div>
    </div>

</div><!-- end #lattice-area -->

<!-- === Bottom Tabs === -->
  <div id="tabs">
    <div class="tab">Context Editor</div>
    <div class="tab">Implication sets</div>
  </div>
</div> <!-- end #main -->

<!-- === Implication Confirmation Modal ===
<div id="modal">
    <p><strong>Confirm or reject implication</strong></p>
    <p>Is it true, that when object has attribute(s) Attr 8, Attr 9, that it also has attribute(s) Attr 1, ..., Attr 7?</p>
    <div id="modal-buttons">
      <button onclick="hideModal()">Yes</button>
      <button onclick="hideModal()">No</button>
      <button onclick="hideModal()">Stop Attribute Exploration</button>
    </div>
</div>
 -->
<!-- === JavaScript Logic === -->

 <script>
    function toggleFullPanel(panelId, button) {
      const panel = document.getElementById(panelId);
      const isFullscreen = panel.classList.contains('fullscreen-panel');
      panel.classList.toggle('fullscreen-panel');
      button.textContent = isFullscreen ? 'üóñ' : 'üóï';
    }

    function hideModal() {
      document.getElementById("modal").style.display = "none";
    }
  </script>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  const pathEl = document.getElementById("document-path");

  const LABELS = {
    context: "Context",
    lattice: "Lattice",
    implications: "Implications"
  };

  const ICONS = {
    context: "‚åó",
    lattice: "üï∏Ô∏è",          // pick any symbol you like (üî∑, üï∏Ô∏è, ‚åó, etc.)
    implications: "‚âÉ"
  };

  function renderPath(parts) {
    // parts: ["context"] or ["context","lattice"] etc.
    if (!parts || parts.length === 0) {
      pathEl.innerHTML = "Currently: ‚Äì";
      return;
    }
    const lines = ['<div class="muted">Currently:</div>'];
    parts.forEach((p, i) => {
      const isActive = i === parts.length - 1;
      lines.push(
        `<div class="crumb ${isActive ? 'is-active' : 'is-parent'}">
           <span class="icon">${ICONS[p] ?? ""}</span>
           <span class="label">${LABELS[p] ?? p}</span>
         </div>`
      );
    });
    pathEl.innerHTML = lines.join("");
  }

  function setState(state) {
    // Map state to path parts
    const parts =
      state === "context" ? ["context"] :
      state === "lattice" ? ["context", "lattice"] :
      state === "implications" ? ["context", "implications"] : [];
    renderPath(parts);
  }

  // start idle
  setState("idle");

  // wire buttons
  const $ = id => document.getElementById(id);
  $("show-formal-context")?.addEventListener("click", () => setState("context"));
  $("create-formal-context")?.addEventListener("click", () => setState("context"));
  $("visualize-lattice")?.addEventListener("click", () => setState("lattice"));

  // expose if you want to trigger from elsewhere
  window.setDocumentBreadcrumbState = setState;
});
</script>


<!-- ‚úÖ Main logic -->
<script type="module" src="../../dist/bundle.js"></script>


</body>
</html>
